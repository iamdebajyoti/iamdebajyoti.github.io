//2019-06-25 Try handling stylesheet errors (webfont of css)
//2019-10-30 excel_upload address fix
//2019-12-08 excel_upload ,download javascript로 변환
//2019-12-15 excel_upload시 0101은 문자로 1010은숫자로 인식 되는 현상 수정
//2020-10-27 그리드 font명에 공백이 있을경우 엑셀 출력시 오류 수정
//2020-12-09 getWaiElem 수정 - innerHtml 속성 확인
//2021-02-10 Excel 출력 cell width가 없을 경우 기본 width=100 지정 
//2021-02-25 FileUpload 경로에서 / 제거 

var $waiRTL=null;!function(){$waiRTL=new function(){this.getWaiElem=function(t){var e={isComp:!1,objID:void 0,parent:void 0,element:void 0,wrapDiv:void 0};try{for(var i=t.parentElement;;){var o=i.getAttribute("_container");if(void 0===i)break;if("HTML"==i.tagName.toUpperCase()||"BODY"==i.tagName.toUpperCase()||"yes"==o||"Y"==$(i).attr("_innerHtml")){e.isComp=!1,e.compObj=t;break}if("$comp$"==i.getAttribute("iswai")){if(e.isComp=!0,e.objID=i.getAttribute("objid"),e.parent=i.parentElement,e.wrapDiv=i,i.children.length>0)for(var n=0;n<i.children.length;n++){var r=i.children[n];if("NONE"!=(r.style.display+"").toUpperCase()){e.element=r;break}}else e.element=void 0;break}i=i.parentElement}e.isComp||(e.objID=t.getAttribute("id"),e.parent=t.parentElement,e.element=t)}catch(t){}return e},this.getWaiChilds=function(t){for(var e={children:[]},i=0;i<t.children.length;i++){var o=t.children[i];if("$comp$"==o.getAttribute("iswai"))if(o.children.length>0){for(var n=void 0,r=0;r<o.children.length;r++)if("NONE"!=(o.children[r].style.display+"").toUpperCase()){n=o.children[r];break}e.children.push(n)}else e.children.push(o);else e.children.push(t.children[i])}return e},this.getElementByTagName=function(t){var e=$("*"),i=[],o=window;for(var n in e){var r=$waiRTL.getWaiElem(e[n]);if(r.isComp)try{(o[r.objID].declare.tagName+"").toUpperCase()==t.toUpperCase()&&-1==$.inArray(o[r.objID],i)&&i.push(o[r.objID])}catch(t){}else(e[n].tagName+"").toUpperCase()==t.toUpperCase()&&i.push(e[n])}return i},this.checkKeyArr=function(t,e){return e.indexOf(t)>=0}};$wai.classes.compStyleInst=function(t){this._parent=t};$wai.rtl.style=new function(){!function(t){function e(t,e){return/^@/.test(t)?(t=t.split(" "))&&{identifier:t.shift().substr(1).toLowerCase(),parameters:t.join(" ")}:(e?/:$/:/:/).test(t)?(t=t.split(":"))&&{property:t.shift(),value:t.join(":")}:t}t.parseCSS=function(t){return function(t,i,o){for(var n;null!=(n=i.exec(t));)"{"==n[2]?o.block.push(o={selector:e(n[1],!0),block:[],parent:o}):"}"==n[2]?o=o.parent:";"==n[2]&&o.block.push(e(n[1]))}(function(t){return t.replace(/\/\*[\W\w]*?\*\//g,"").replace(/^\s+|\s+$/g,"").replace(/\s*([:;{}])\s*/g,"$1").replace(/\};+/g,"}").replace(/([^:;{}])}/g,"$1;}")}(t),/([^{};]*)([;{}])/g,t={block:[]}),t}}(this),this.getCssRules=function(t){var e=document,i=null,o=[],n=!0;void 0===t?i=document.head.childNodes:(e=t,i=t.head.childNodes);for(var r=0;r<i.length;r++){var a=i[r];n?"#comment"==a.nodeName&&"wai.load.end"==(a.nodeValue+"").trim()&&(n=!1):"LINK"==(a.nodeName+"").toUpperCase()&&o.push(a.href)}var s=[];function l(t){var e=t;return e=(e=(e=e.replace(/\{/," {\n  ")).replace(/\;/g,";\n  ")).replace(/  \}/g,"}")}for(var h=0;h<e.styleSheets.length;h++)for(var c=e.styleSheets[h],u=0;u<c.cssRules.length;u++){var d=c.cssRules[u];try{var f=(d.selectorText+"").trim();if(f.indexOf(":")>=0||f.indexOf(">")>=0)continue;function p(t){for(var e=(t+"").replace(/,/g,"").trim(),i=[],o="",n=0;n<e.length;n++)"."!=e[n]&&"#"!=e[n]&&" "!=e[n]||(""!==o&&i.push(o),o="")," "!==e[n]&&(o+=e[n]);return""!==o&&i.push(o),i}for(var g=p(d.selectorText),v=0;v<g.length;v++)if(null==d.parentStyleSheet.href){var b=l(d.cssText);s.push({name:g[v],rule:d,text:b})}else for(var m=0;m<o.length;m++)if(d.parentStyleSheet.href==o[m]){b=l(d.cssText),s.push({name:g[v],rule:d,text:b});break}}catch(t){console.error(t)}}return s};var t="",e=[];this.getCssRule=function(i,o){var n=null;if(void 0===o)n=this.getCssRuleAsDoc(i);else{!function(i){var o,n,r;if(void 0!==i&&""!==i&&i!=t)for(t=i,e=[],n=0;n<document.styleSheets.length;n++){o=document.styleSheets[n];try{for(r=0;r<o.cssRules.length;r++)(o.cssRules[r].selectorText+"").indexOf(i)>=0&&e.push(o.cssRules[r])}catch(t){console.log(document.styleSheets[n].href,t.message)}}}(o);for(var r=0;r<e.length;r++){curRI=e[r];try{for(var a=curRI.selectorText.split(","),s=0;s<a.length;s++)if(a[s].trim()==i.trim()){n={name:a[s],rule:curRI};break}}catch(t){}}}return n},this.getCssRuleAsDoc=function(t){for(var e=null,i=0;i<document.styleSheets.length;i++)for(var o=document.styleSheets[i],n=null,r=0;r<o.cssRules.length;r++){n=o.cssRules[r];try{for(var a=n.selectorText.split(","),s=0;s<a.length;s++)if(a[s].trim()==t.trim()){e={name:a[s],rule:n};break}}catch(t){}}return e},this.getRule=function(t,e){var i=null,o=this.getCssRule(t,e);if(null!=o){var n=o.rule.cssText,r=this.parseCSS(n);i={name:o.name,cssText:o.rule.cssText,items:{}};try{for(var a=0;a<r.block[0].block.length;a++){var s=r.block[0].block[a];i.items[s.property]=s.value}}catch(t){console.error("_styleManager.getRule cssText parsed error : "+t.message)}}return i},this.getFontInfo=function(t){var e={weight:"",size:12,family:"Tahoma",color:"black",text:""};if(t.font){var i=t.font.split("/");if(i.length>0&&(r=(n=i[0]).lastIndexOf("px"))>=1)try{e.size=parseInt(n.substring(0,r).trim())}catch(t){}if(i.length>1){var o=i[1].split(" ");e.weight=o[0],e.family=o[1]}if((r=(n=(e=function(t){var e=null,i=null,o="normal",n="normal",r="normal",a="normal",s=t.split(/\s+/);t:for(;element=s.shift();)switch(element){case"normal":break;case"italic":case"oblique":o=element;break;case"small-caps":r=element;break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":n=element;break;default:if(!i){var l=element.split("/");i=l[0],l.length>1&&(a=l[1]);break}e=element,s.length&&(e+=" "+s.join(" "));break t}return{style:o,variant:r,weight:n,size:i,lineHeight:a,family:e}}(t.font)).size).lastIndexOf("px"))>=1)try{e.size=parseInt(n.substring(0,r).trim())}catch(t){}}else{var n,r;if(void 0!==t["font-weight"]&&(e.weight=t["font-weight"]),void 0!==t["font-size"]&&(r=(n=t["font-size"]).lastIndexOf("px"))>=1)try{e.size=parseInt(n.substring(0,r).trim())}catch(t){console.log("result.size ["+n.substring(0,r)+"]")}void 0!==t["font-family"]&&(e.family=t["font-family"])}return void 0!==t.color&&(e.color=t.color),e.text=e.weight+" "+e.size+"px "+e.family,e},this.getRuleFontInfo=function(t,e){var i=this.getRule(t,e);if(null!=i)o=this.getFontInfo(i.items);else{var o={weight:"",size:12,family:"Tahoma",color:"black",text:"12px Tahoma"};console.warn("waiGrid fontStyle ["+t+"] not founded. return default",o)}return o},this.getTextFontInfo=function(t){for(var e=["weight","size","family","color"],i={weight:"",size:12,family:"Tahoma",color:"black",text:"12px Tahoma"},o=t.split(" "),n=0,r=0;r<o.length;r++){var a=o[r].trim();if(""!=a){switch(n){case 1:var s=a.substring(0,a.lastIndexOf("px")).trim();i[e[n]]=parseInt(s);break;default:i[e[n]]=a}n++}}return i.text=i.weight+" "+i.size+"px "+i.family,i},this.getRuleItemValue=function(t,e,i){var o=void 0,n=this.getRule(t,i);return null!=n&&(o=n.items[e]),o};var i=null;this.genCssObject=function(e,o,n){if(null!==i&&n==t)return i;for(var r in e)for(var a in e[r]){var s=e[r][a];if("font"==a){var l=this.getRuleFontInfo(s,n);e[r][a]=l}else if("color"==a)if(typeof s==typeof[])for(var h=0;h<s.length;h++)s[h]=this.getRuleItemValue(s[h],a,n);else e[r][a]=this.getRuleItemValue(s,a,n);else if("content"==a){var c=this.getRuleItemValue(s,a,n);e[r][a]=new Image,e[r][a].src=o.path+"/"+c.replace(/^url\(['"](.+)['"]\)/,"$1")}else try{e[r][a]=this.getRuleItemValue(s,a,n),void 0===e[r][a]&&console.warn("cannot generate cssObject ["+s+"."+a+"]")}catch(t){console.warn("cannot generate cssObject ["+s+"."+a+"]")}}return i=e,e},this.setFillStyle=function(t,e,i){var o="white";if(typeof e==typeof[])switch(e.length>=2&&(o=t.createLinearGradient(0,i.top,0,i.bottom)),e.length){case 1:o=e[0];break;case 2:o.addColorStop(0,e[0]),o.addColorStop(1,e[1]);break;case 3:o.addColorStop(0,e[0]),o.addColorStop(.5,e[1]),o.addColorStop(1,e[2]);break;case 4:o.addColorStop(0,e[0]),o.addColorStop(.5,e[1]),o.addColorStop(.75,e[2]),o.addColorStop(1,e[3]);break;case 5:o.addColorStop(0,e[0]),o.addColorStop(.25,e[1]),o.addColorStop(.5,e[2]),o.addColorStop(.75,e[3]),o.addColorStop(1,e[4])}else o=e;t.fillStyle=o},this.setFontStyle=function(t,e){t.font=e.text,t.fillStyle=e.color}};$wai.rtl.draw=new function(){this.roundRect=function(t,e,i,o,n,r,a,s){if(void 0===s&&(s=!0),void 0===r&&(r=7),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var l={tl:0,tr:0,br:0,bl:0};for(var h in l)r[h]=r[h]||l[h]}t.beginPath(),t.moveTo(e+r.tl,i),t.lineTo(e+o-r.tr,i),t.quadraticCurveTo(e+o,i,e+o,i+r.tr),t.lineTo(e+o,i+n-r.br),t.quadraticCurveTo(e+o,i+n,e+o-r.br,i+n),t.lineTo(e+r.bl,i+n),t.quadraticCurveTo(e,i+n,e,i+n-r.bl),t.lineTo(e,i+r.tl),t.quadraticCurveTo(e,i,e+r.tl,i),t.closePath(),a&&t.fill(),s&&t.stroke()}};$wai.classes.iconLoader=function(t,e){var i=this;this.image=new Image,this.loaded=!1,this.image.onload=function(){i.loaded=!0,void 0!==e&&e(i)},this.image.src=t,this.getIconCanvas=function(t,e,i,o){var n=this.image.width,r=this.image.height,a=null;return o<n/t&&i<r/e&&((a=document.createElement("canvas")).width=t,a.height=e,a.getContext("2d").drawImage(this.image,t*o,e*i,t,e,0,0,t,e)),a},this.drawIcon=function(t,e,i,o,n,r,a){var s=this.image.width,l=this.image.height;o<s/t&&i<l/e&&n.drawImage(this.image,t*o,e*i,t,e,r,a,t,e)}};$wai.classes.imageLoader=function(t,e){var i=this;this.images=[],this.loaded=!1;for(var o=0,n=0;n<t.length;n++){var r=new Image;r.onload=function(){++o==t.length&&(i.loaded=!0,void 0!==e&&e(i))},r.src=t[n].url;var a={id:t[n].id,image:r,url:t[n].url};this.images.push(a)}this.getImage=function(t){for(var e=null,i=0;i<this.images.length;i++)if(this.images[i].id==t){e=this.images[i];break}return e},this.draw=function(t,e,i,o){var n=this.getImage(t);null!=n&&e.drawImage(n.image,i,o)}};$wai.rtl.sortBy=function(t,e,i){var o=i?function(e){return i(e[t])}:function(e){return e[t]};return e=e?-1:1,function(t,i){return t=o(t),i=o(i),e*((t>i)-(i>t))}};$wai.rtl.sortFieldData=new function(){var t=Object.prototype.toString,e=function(t){return t},i=function(e){return this.parser("[object Object]"===t.call(e)&&e[this.prop]||e)};return function(o,n){return o instanceof Array&&o.length?("[object Object]"!==t.call(n)&&(n={}),"function"!=typeof n.parser&&(n.parser=e),n.desc=[1,-1][+!!n.desc],o.sort(function(t,e){return(((t=i.call(n,t))>(e=i.call(n,e)))-(e>t))*n.desc})):[]}};$wai.rtl.getDataServicesInfo=function(){for(var t=[],e=$("dataService"),i=0;i<e.length;i++){var o={},n={};for(var r in $(e[i].attributes).each(function(){var t=this.nodeName,e=null;try{e=$wai.info.browser.isFirefox?this.value:this.nodeValue}catch(t){}o[t]=e}),o)n[r]=o[r];t.push(n)}return t};$wai.rtl.setDataServicesInfo=function(t){var e=$("dataServices");e.length>0&&e.remove(),$("body").prepend($.parseXML("<dataServices></dataServices>").documentElement),e=$("dataServices");for(var i=0;i<t.length;i++){var o,n="";for(var r in t[i])typeof t[i][r]==typeof{}||(n+=r+'="'+t[i][r]+'" ');o="<dataService "+n.trim()+"></dataService>",e.append($.parseXML(o).documentElement)}};$wai.rtl.getTISMapGroups=function(t){var e=[],i="",o=!1;if($.ajax({type:"POST",url:t,dataType:"xml",async:!1,timeout:1500,error:function(t,e,i){o=!0},success:function(t,e,o){i=t}}),o)return e;var n=$.xml2json(i);if(void 0!==n.InOutInfo&&null!==n.InOutInfo&&""!=n.InOutInfo){var r=n.InOutInfo,a=[],s=[];void 0!==r.InputData&&null!==r.InputData&&""!=r.InputData&&(void 0===r.InputData.ParamInfo.length?a.push(r.InputData.ParamInfo):a=r.InputData.ParamInfo),void 0!==r.OutputData&&null!==r.OutputData&&""!=r.OutputData&&(void 0===r.OutputData.ParamInfo.length?s.push(r.OutputData.ParamInfo):s=r.OutputData.ParamInfo);for(var l=0;l<a.length;l++){var h=[];void 0===a[l].FieldInfo.length?h.push(a[l].FieldInfo):h=a[l].FieldInfo;var c={type:"input",name:a[l].name,field:h};e.push(c)}for(l=0;l<s.length;l++)h=[],void 0===s[l].FieldInfo.length?h.push(s[l].FieldInfo):h=s[l].FieldInfo,c={type:"output",name:s[l].name,field:h},e.push(c)}return e};$wai.rtl.dataServiceInfoToTag=function(t){for(var e="  <DataServices>\n",i=0;i<t.length;i++){t[i];var o='    <dataService id="'+t[i].id+'" ';for(var n in t[i])"id"!=n&&(o+=n+'="'+t[i][n]+'" ');e=e+"    "+(o=o.trim())+"></dataService>\n"}return e+="  </DataServices>\n"};$wai.rtl.getCustScriptFunctions=function(t){var e=[],i=window;for(var o in void 0!==t&&(i=t),i)if(i.hasOwnProperty(o)&&"function"==typeof i[o]&&!/\[native code\]/.test(i[o].toString())){var n=[],r=i[o].prototype.constructor+"",a=(r=r.substr(0,r.indexOf("{"))).substr(r.indexOf("(")+1,r.lastIndexOf(")")-r.indexOf("(")-1),s="";if(""!=a)for(var l=a.split(","),h=0;h<l.length;h++)""!=l[h].trim()&&(n.push(l[h].trim()),""!=s&&(s+=", "),s+=l[h].trim());var c="function "+o+"("+s+")";e.push({name:o,args:n,funcText:c,funcInst:i[o]})}return e};$wai.classes.canvasScrollbar=function(){var t=this;this.value=0,this.visible=!1,this.option={direction:"vert",drawRect:{left:0,top:0,right:0,bottom:0,width:0,height:0},drawCtx:null,maxPos:100,curSize:10,value:0,disable:!1,images:null,onUpBtnClick:null,onDownBtnClick:null,onScroll:null,onRedrawed:null};var e=null,i=null,o={btn1:[0,0,0,0],btn2:[0,0,0,0],cursor:[0,0,0,0],cursorBefore:[0,0,0,0],cursorAfter:[0,0,0,0]};this.style={border:["#EAEAEA"],bgColor:["#EAEAEA"],btnBg:["#C0C0C0"],btnBgOn:["#C0C0FF"],psColor:["#909090"],psColorOn:["#A0A0B0"],psBorder:["#404040"]},this.init=function(t){for(var o in null==e&&(e=document.createElement("canvas")),this.option)void 0!==t[o]&&(this.option[o]=t[o]);if(this.option.drawRect.right=this.option.drawRect.left+this.option.drawRect.width,this.option.drawRect.bottom=this.option.drawRect.top+this.option.drawRect.height,e.width=this.option.drawRect.width,e.height=this.option.drawRect.height,i=e.getContext("2d"),void 0!==this.option.value&&(this.value=this.option.value),void 0!==this.option.disable&&(this.disable=this.option.disable),void 0!==t.style&&typeof t.style==typeof{})for(var r in t.style)this.style[r]=t.style[r];n.onOver=!1,n.onItem="",this.visible=!0},this.redraw=function(){var t=this.option.drawRect,a=this.style;$wai.rtl.style.setFillStyle(i,a.border,t),i.fillRect(0,0,t.width,t.height),$wai.rtl.style.setFillStyle(i,a.bgColor,t),i.fillRect(1,1,t.width-2,t.height-2);var s=[0,0,0,0],l=[0,0,0,0],h=0,c=0;"horz"==this.option.direction.toLowerCase()?(s=[1,1,t.height-2,t.height-2],l=[t.width-t.height,1,t.height-1,t.height-2],h=t.height-2,c=t.width-2-2*t.height):(s=[1,1,t.width-2,t.width-2],l=[1,t.height-t.width,t.width-2,t.width-1],h=t.width-2,c=t.height-2-2*t.width);var u=c/this.option.maxPos*this.option.curSize;u>h&&(h=Math.floor(u));var d=Math.round((c-h)/(this.option.maxPos-this.option.curSize)*this.value);if(r.tick=(c-h)/(this.option.maxPos-this.option.curSize),r.tick<=0&&(r.tick=1),"horz"==this.option.direction.toLowerCase()?(o.cursor=[1+s[2]+d,1,4+h,s[3]],o.cursorBefore=[t.height-1,1,d,s[3]],o.cursorAfter=[s[2]+d+h+5,1,t.width-t.height,s[3]]):(o.cursor=[1,1+s[3]+d,s[2],4+h],o.cursorBefore=[1,t.width-1,s[2],d],o.cursorAfter=[1,s[3]+d+h+5,s[2],t.height-t.width]),null==a.psBorder&&(a.psBorder=a.psColor),$wai.rtl.style.setFillStyle(i,a.psBorder,t),i.fillRect(o.cursor[0],o.cursor[1],o.cursor[2],o.cursor[3]),n.onOver&&"cursor"==n.onItem?$wai.rtl.style.setFillStyle(i,a.psColorOn,t):$wai.rtl.style.setFillStyle(i,a.psColor,t),i.fillRect(o.cursor[0]+1,o.cursor[1]+1,o.cursor[2]-2,o.cursor[3]-2),o.btn1=s,o.btn2=l,n.onOver&&"btn1"==n.onItem?$wai.rtl.style.setFillStyle(i,a.btnBgOn,t):$wai.rtl.style.setFillStyle(i,a.btnBg,t),i.fillRect(s[0],s[1],s[2],s[3]),n.onOver&&"btn2"==n.onItem?$wai.rtl.style.setFillStyle(i,a.btnBgOn,t):$wai.rtl.style.setFillStyle(i,a.btnBg,t),i.fillRect(l[0],l[1],l[2],l[3]),void 0!==this.option.images&&null!=this.option.images){var f=this.option.images,p="horz"==this.option.direction.toLowerCase()?0:1,g=f.getIconCanvas(16,16,0,0+p),v=f.getIconCanvas(16,16,0,2+p);try{i.drawImage(g,s[0]+(s[2]/2-g.width/2),s[1]+(s[3]/2-g.height/2)),i.drawImage(v,l[0]+(l[2]/2-v.width/2),l[1]+(l[3]/2-v.height/2))}catch(t){}}this.disable&&(i.fillStyle="rgba(150,150,150,0.5)",t=this.option.drawRect,i.fillRect(0,0,t.width,t.height)),e.width<=0&&(e.width=1),this.option.drawCtx.drawImage(e,t.left,t.top),void 0!==this.option.onRedrawed&&null!=this.option.onRedrawed&&this.option.onRedrawed(e,t.left,t.top)},this.doMouseMove=function(t,e){if(this.visible){var i=0,r=0;if(null!=e)i=e.x,r=e.y;else{if(null==t)return;i=t.offsetX,r=t.offsetY}var a=this.option.drawRect,s=[];for(var l in o){var h=o[l][0]+a.left,c=o[l][1]+a.top,u={n:l,r:[h,c,h+o[l][2],c+o[l][3]]};s.push(u)}for(var d=!1,f=0;f<s.length;f++){var p=s[f].r,g=p[0]<=i&&p[2]>=i,v=p[1]<=r&&p[3]>=r;if(g&&v){n.onItem!=s[f].n&&(n.onItem=s[f].n,n.onOver=!0,this.redraw()),d=!0;break}}d||this.doMouseOut()}},this.doMouseOut=function(){u(),n.onOver&&(n.onItem="",n.onOver=!1,this.redraw())};var n={onOver:!1,onItem:""},r={drag:!1,tick:0,start:{x:0,y:0,value:0}};function a(e){void 0===e&&(e=window.event);var i=1,o=0;"horz"==t.option.direction?e.pageX<r.start.x?(i=-1,o=Math.round((r.start.x-e.pageX)/r.tick)):o=Math.round((e.pageX-r.start.x)/r.tick):e.pageY<r.start.y?(i=-1,o=Math.round((r.start.y-e.pageY)/r.tick)):o=Math.round((e.pageY-r.start.y)/r.tick);var n=r.start.value+o*i;return n>t.option.maxPos-t.option.curSize?n=t.option.maxPos-t.option.curSize:n<0&&(n=0),n!=t.value&&(t.value=n,t.onScroll(),t.redraw()),e.preventDefault(),!1}function s(e){void 0===e&&(e=window.event),r.drag=!1,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",s),t.doMouseEventProc(0,"mousemove",e)}this.disable=!1,this.setDisable=function(t){this.disable!=t&&(this.disable=t,this.redraw())},this.onScroll=function(){void 0!==this.option.onScroll&&null!=this.option.onScroll&&this.option.onScroll(this)},this.scrollUp=function(){this.value-=1,this.value<0&&(this.value=0),this.redraw(),void 0!==this.option.onUpBtnClick&&null!=this.option.onUpBtnClick&&this.option.onUpBtnClick(this)},this.scrollDown=function(){this.value+=1,this.value>this.option.maxPos-this.option.curSize&&(this.value=this.option.maxPos-this.option.curSize),this.redraw(),void 0!==this.option.onDownBtnClick&&null!=this.option.onDownBtnClick&&this.option.onDownBtnClick(this)};var l=null,h=null;function c(t,e){l=window.setTimeout(d,500,t,e)}function u(){window.clearTimeout(l),window.clearInterval(h)}function d(t,e){h=window.setInterval(f,50,t,e)}function f(e,i){"btn1"==n.onItem?t.scrollUp():"btn2"==n.onItem?t.scrollDown():"cursorBefore"==n.onItem?(t.scrollUp(),t.doMouseMove(e,i)):"cursorAfter"==n.onItem&&(t.scrollDown(),t.doMouseMove(e,i))}this.doMouseEventProc=function(t,e,i,o){var l=!1;if(this.disable)return!1;if(r.drag)return!1;if(null!=i){var h=0,d=0;null!=o?(h=o.x,d=o.y):(h=i.offsetX,d=i.offsetY);var f=this.option.drawRect,p=f.left<=h&&f.right>=h,g=f.top<=d&&f.bottom>=d;if(p&&g){switch(t){case 0:this.doMouseMove(i,o);break;case 1:n.onOver&&("btn1"==n.onItem?(this.scrollUp(),c()):"btn2"==n.onItem?(this.scrollDown(),c()):"cursor"==n.onItem?(r.drag=!0,r.start.x=i.pageX,r.start.y=i.pageY,r.start.value=this.value,document.addEventListener("mousemove",a),document.addEventListener("mouseup",s)):"cursorBefore"==n.onItem?(this.scrollUp(),c(i,o)):"cursorAfter"==n.onItem&&(this.scrollDown(),c(i,o)));break;case 2:u()}l=!0}else this.doMouseOut();return l}}};$wai.classes.canvasToolbar=function(){this.disable=!1,this.option={buttons:[],disable:!1,direction:"horz",drawRect:{left:0,top:0,right:0,bottom:0,width:0,height:0},drawCtx:null,iconSize:{w:16,h:16},iconMargin:0,hintCanvas:null,autoSize:!0,icons:null,onMouseEvent:null,onRedrawed:null},this.style={bgColor:"white",overBgColor:["rgba(160,160,255,0.2)","rgba(160,160,255,0.3)","rgba(160,160,255,0.5)"],checkColor:["rgba(255,160,160,0.2)","rgba(255,160,160,0.3)","rgba(255,160,160,0.5)"]};var t=null,e=null,i=-1,o="";this.inited=!1,this.init=function(n){for(var r in null==t&&(t=document.createElement("canvas")),i=-1,this.option)void 0!==n[r]&&(this.option[r]=n[r]);if(1==this.option.autoSize){var a=this.option.drawRect,s=this.option.iconSize,l=("horz"==this.option.direction?a.height>s.w?a.height:s.w:a.width>s.h?a.width:s.h)*this.option.buttons.length+this.option.iconMargin*(this.option.buttons.length-1);"horz"==this.option.direction?this.option.drawRect.width=l+1:this.option.drawRect.height=l+1}if(this.option.drawRect.right=this.option.drawRect.left+this.option.drawRect.width,this.option.drawRect.bottom=this.option.drawRect.top+this.option.drawRect.height,t.width=this.option.drawRect.width,t.height=this.option.drawRect.height,e=t.getContext("2d"),void 0!==n.style&&typeof n.style==typeof{})for(var h in n.style)this.style[h]=n.style[h];if(this.disable=void 0!==n.disable&&n.disable,null!=this.option.hintCanvas&&void 0!==this.option.hintCanvas)try{o=this.option.hintCanvas.title}catch(t){console.error(t.message)}},this.redraw=function(){var o=this.option.icons,n=this.option.iconMargin,r=this.option.drawRect,a=this.option.iconSize,s=0,l=0;l="horz"==this.option.direction?r.height>a.w?r.height:a.w:r.width>a.h?r.width:a.h,""!=this.style.bgColor?($wai.rtl.style.setFillStyle(e,this.style.bgColor,r),e.fillRect(0,0,r.width-1,r.height-1)):e.clearRect(0,0,r.width-1,r.height-1);for(var h=0;h<this.option.buttons.length;h++){var c=this.option.buttons[h].iconIndex;if(null!=o&&void 0!==o)if("horz"==this.option.direction){if(h==i&&(""!=this.style.overBgColor&&($wai.rtl.style.setFillStyle(e,this.style.overBgColor,{top:0,bottom:r.height-1}),$wai.rtl.draw.roundRect(e,s,0,l,r.height-1,void 0,!0,!1)),null!=this.option.hintCanvas&&void 0!==this.option.hintCanvas))try{this.option.hintCanvas.title=this.option.buttons[h].hint}catch(t){console.error(t.message)}o.drawIcon(a.w,a.h,c.r,c.c,e,s+(l/2-a.w/2)-1,r.height/2-a.h/2-1)}else{if(h==i&&(""!=this.style.overBgColor&&($wai.rtl.style.setFillStyle(e,this.style.overBgColor,{top:s,bottom:s+l-1}),$wai.rtl.draw.roundRect(e,0,s,r.width-1,l,void 0,!0,!1)),null!=this.option.hintCanvas&&void 0!==this.option.hintCanvas))try{this.option.hintCanvas.title=this.option.buttons[h].hint}catch(t){console.error(t.message)}o.drawIcon(a.w,a.h,c.r,c.c,e,r.width/2-a.w/2,s+(l/2-a.h/2))}s+=l+n}this.disable&&(e.fillStyle="rgba(150,150,150,0.5)",r=this.option.drawRect,e.fillRect(0,0,r.width,r.height)),t.width<=0&&(t.width=1),this.option.drawCtx.drawImage(t,r.left,r.top),void 0!==this.option.onRedrawed&&null!=this.option.onRedrawed&&this.option.onRedrawed(t,r.left,r.top)},this.mouseEventsDistribute=function(t,e,o){var n=!0;if(i<0)return n;var r=void 0!==this.option.onMouseEvent&&null!=this.option.onMouseEvent?this.option.onMouseEvent:null;return null!=r&&(n=r({id:t,name:e,event:o},this.option.buttons[i],this)),n},this.doMouseEventProc=function(t,e,i,o){if(this.disable)return!1;var n=0,r=0;null!=o?(n=o.x,r=o.y):(n=i.offsetX,r=i.offsetY);var a=this.option.drawRect,s=a.left<=n&&a.right>=n,l=a.top<=r&&a.bottom>=r;if(s&&l)switch(t){case 0:this.doMouseMove(i,o);break;case 1:this.mouseEventsDistribute(2,"mousedown",i);break;case 2:this.mouseEventsDistribute(3,"mouseup",i);break;case 3:break;case 4:this.mouseEventsDistribute(5,"dblclick",i)}else this.doMouseOut(i)},this.doMouseMove=function(t,e){var o=0,n=0;null!=e?(o=e.x,n=e.y):(o=t.offsetX,n=t.offsetY);var r=this.option.iconMargin,a=this.option.drawRect,s=this.option.iconSize,l=0,h=0;h="horz"==this.option.direction?a.height>s.w?a.height:s.w:a.width>s.h?a.width:s.h;for(var c=!1,u=0;u<this.option.buttons.length;u++){var d=null,f=(d="horz"==this.option.direction?[a.left+l,a.top,a.left+l+h,a.bottom]:[a.left,a.top+l,a.right,a.top+l+h])[0]<=o&&d[2]>=o,p=d[1]<=n&&d[3]>=n;if(f&&p){u!=i&&(i=u,this.mouseEventsDistribute(0,"mouseover",t),this.redraw()),c=!0;break}l+=h+r}c||this.doMouseOut(t)},this.doMouseOut=function(t){if(!(i<0)){if(null!=this.option.hintCanvas&&void 0!==this.option.hintCanvas)try{this.option.hintCanvas.title=o}catch(t){console.error(t.message)}this.mouseEventsDistribute(1,"mouseout",t),i=-1,this.redraw()}}};$wai.classes.canvasTabCtrl=function(t,e){this.id=t.id;var i={lockable:!1,closable:!0,icons:null,iconSize:16,tabs:[],tabMargin:5,fitWidth:!1,emptyElem:void 0,style:{borderColor:"#808080",bgColor:"#eaeaea",tabOff:"#D2D1D0",tabOn:"white",font:"12px tahoma",fontColor:"black"},onMouseEvent:void 0,onClick:void 0,onContext:void 0,onChanging:void 0,onClosing:void 0,onMore:void 0,onCloseIcon:void 0};for(var o in this.option=JSON.parse(JSON.stringify(i)),e)"style"!=o&&(this.option[o]=e[o]);if(void 0!==e.style)for(var n in e.style)this.option.style[n]=e.style[n];var r=this;this.getStyle=function(t,e){var i,o=(t.ownerDocument||document).defaultView;return o&&o.getComputedStyle?(e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),o.getComputedStyle(t,null).getPropertyValue(e)):t.currentStyle?(e=e.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),i=t.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(i)?function(e){var i=t.style.left,o=t.runtimeStyle.left;return t.runtimeStyle.left=t.currentStyle.left,t.style.left=e||0,e=t.style.pixelLeft+"px",t.style.left=i,t.runtimeStyle.left=o,e}(i):i):void 0};var a=this.getStyle(t,"width"),s=this.getStyle(t,"height");$(t).replaceWith('<div id="'+this.id+'_tabctrl_Div" style="'+t.style.cssText+'">\n  <input type="text" id="'+this.id+'_tabctrl_key" value="" style="z-index:-1000;position:absolute;top:-5000px;left:-5000px">\n  <canvas id="'+this.id+'_tabctrl_canvas" width="'+a+'" height="'+s+'" class="" style="width:100%;height:100%;border:none" onselectstart="return false;"></canvas>\n</div>'),window[this.id]=this,this.tcDiv=$("#"+this.id+"_tabctrl_Div"),this.tcKey=$("#"+this.id+"_tabctrl_key"),this.tcCanvas=$("#"+this.id+"_tabctrl_canvas"),this.ctx=this.tcCanvas[0].getContext("2d"),this.width=this.tcCanvas[0].width,this.height=this.tcCanvas[0].height,this.init=function(){for(var t=this.option.tabs,e=0;e<t.length;e++)this.addTab(t[e]);this.tabs.length>0&&(this.curOnTab=0,this.pageDisplayCtrl()),this.draw()},window.addEventListener("resize",function(t){try{var e=r.getStyle(r.tcDiv[0],"width"),i=r.getStyle(r.tcDiv[0],"height");r.width=parseInt(e.substr(0,e.indexOf("px"))),r.height=parseInt(i.substr(0,i.indexOf("px"))),r.tcCanvas[0].width=r.width,r.tcCanvas[0].height=r.height,r.ctx=r.tcCanvas[0].getContext("2d"),r.draw()}catch(t){console.log(t.message)}});var l={id:0,text:"",img:"",isLocked:!1,visible:!0,pageElem:void 0,data:void 0},h=function(t){this.id=t.id,this.text=t.text,this.data=t.data,this.img=t.img,this.visible=t.visible,this.isShow=!0,this.isLocked=t.isLocked,this.isCloseOver=!1,this.pageElem=t.pageElem,this.rect={l:0,t:0,w:0,h:0,r:0,b:0,tL:0,tT:0}};this.tabs=[],this.addTab=function(t,e){var i=JSON.parse(JSON.stringify(l));for(var o in t)i[o]=t[o];this.tabs.push(new h(i)),!0===e?(this.curOnTab=this.tabs.length-1,this.selectTab(this.tabs[this.curOnTab].id,!0)):(d&&this._draw(),this.pageDisplayCtrl()),void 0!==this.option.emptyElem&&(this.option.emptyElem.style.display=this.tabs.length>0?"none":"")},this.insertTab=function(t,e){var i=JSON.parse(JSON.stringify(l));for(var o in t)i[o]=t[o];this.curOnTab>=0?(this.tabs.splice(this.curOnTab+1,0,new h(i)),!0===e&&(this.curOnTab++,this.selectTab(this.tabs[this.curOnTab].id,!0))):(this.tabs.push(new h(i)),!0===e&&(this.curOnTab=this.tabs.length-1,this.selectTab(this.tabs[this.curOnTab].id,!0))),void 0!==this.option.emptyElem&&(this.option.emptyElem.style.display=this.tabs.length>0?"none":"")},this.clearTab=function(){for(var t=0;t<this.tabs.length;t++){var e=this.tabs[t].pageElem;null!=e&&$(e).remove()}this.tabs=[],this.curOnTab=-1,d&&this._draw()},this.closeAll=function(t){for(var e=new Array,i=this.tabs.length-1;i>=0;i--){var o=void 0,n=this.tabs[i],r=JSON.parse(JSON.stringify(this.tabs[i]));if(e.push(r),!0===t){if(void 0!==this.option.onChanging&&null!=this.option.onChanging){var a=null;this.curOnTab>=0&&(a=this.tabs[this.curOnTab]),o=null!=a?a.id!==n.id&&this.option.onChanging(null,a,this.tabs[i]):this.option.onChanging(null,a,this.tabs[i])}!1!==o&&(this.curOnTab=i,this.pageDisplayCtrl(),this.draw())}if(void 0!==this.option.onClosing&&null!=this.option.onClosing&&(o=this.option.onClosing(null,n)),!1===o)break;this.delTabOfID(n.id),this.draw()}return e},this.closeOther=function(){for(var t=new Array,e=this.tabs.length-1;e>=0;e--)if(this.curOnTab!=e){var i=void 0,o=this.tabs[e],n=JSON.parse(JSON.stringify(this.tabs[e]));if(t.push(n),void 0!==this.option.onClosing&&null!=this.option.onClosing&&(i=this.option.onClosing(null,o)),!1===i)break;this.curOnTab>e&&(this.curOnTab=e),this.delTabOfID(o.id)}return t},this.getTab=function(t){for(var e=null,i=0;i<this.tabs.length;i++)if(this.tabs[i].id==t){e=this.tabs[i];break}return e},this.getTabIndex=function(t){for(var e=-1,i=0;i<this.tabs.length;i++)if(this.tabs[i].id==t){e=i;break}return e},this.getCurrentTab=function(){var t=null;return this.curOnTab>=0&&(t=this.tabs[this.curOnTab]),t},this.getHiddenTabs=function(){for(var t=[],e=0;e<this.tabs.length;e++)!1===this.tabs[e].isShow&&this.tabs[e].visible&&t.push(this.tabs[e]);return t},this.closeCurrent=function(){var t=new Array;if(this.curOnTab>=0){var e=JSON.parse(JSON.stringify(this.tabs[this.curOnTab]));this.closeTab(this.tabs[this.curOnTab].id),t.push(e)}else console.warn("TabCtrl.closeCurrent : Can not close current tab (selected tab not found)");return t},this.closeTab=function(t,e){var i=this.getTab(t);if(null!=i){if(!0===e){var o=this.getTabIndex(t);if(!this.tabs[o].visible){if(void 0!==this.option.onChanging&&null!=this.option.onChanging){var n=null;this.curOnTab>=0&&(n=this.tabs[this.curOnTab]),null!=n?n.id!==i.id?rt=this.option.onChanging(null,n,this.tabs[o]):rt=!1:rt=this.option.onChanging(null,n,this.tabs[o])}!1!==rt&&(this.curOnTab=o,this.draw(),this.pageDisplayCtrl())}}void 0!==this.option.onClosing&&null!=this.option.onClosing&&(rt=this.option.onClosing(null,i)),!1!==rt&&(this.delTabOfID(i.id),this.draw())}else console.warn("TabCtrl.closeTab : Can not close tab (tab not found : "+t+")")},this.selectTab=function(t,e){for(var i=-1,o=0;o<this.tabs.length;o++)if(this.tabs[o].id==t){i=o;break}if(this.tabs[i].visible){var n=this.curOnTab!=i;if(!0===e&&(n=!0),i>=0&&n){var r=void 0;if(void 0!==this.option.onChanging&&null!=this.option.onChanging){var a=null;this.curOnTab>=0&&(a=this.tabs[this.curOnTab]),r=this.option.onChanging(null,a,this.tabs[i])}!1!==r&&(this.curOnTab=i,this.pageDisplayCtrl(),this.draw())}else i<0&&console.warn("TabCtrl.selectTab : Can not select tab (tab not found : "+t+")")}else console.warn('TabCtrl.selectTab : Can not select tab. "'+t+'" is not visible')},this.pageDisplayCtrl=function(){for(var t=0;t<this.tabs.length;t++){var e=this.tabs[t].pageElem;this.curOnTab!=t?$(e).css("display","none"):$(e).css("display","")}void 0!==this.option.emptyElem&&(this.option.emptyElem.style.display=this.tabs.length>0?"none":"")},this.delTabOfID=function(t){for(var e=-1,i=0;i<this.tabs.length;i++)if(this.tabs[i].id==t){e=i;break}e>=0&&this.delTabOfIndex(e)},this.delTabOfIndexX=function(t){var e=this.tabs[t].pageElem;$(e).remove(),this.tabs.splice(t,1),c(),this.pageDisplayCtrl()},this.delTabOfIndex=function(t){var e=this.tabs[t].pageElem;if("IFRAME"===(e.tagName+"").trim().toUpperCase()){var i=!1;try{var o=(void 0!==e.contentWindow?e.contentWindow:e).document.body,n=$(o).find("iframe");i=n.length>0;for(var r=0;r<n.length;r++){var a=n[r];$(a).attr("src","about:blank")}}catch(t){console.log("delTabOfIndex.child.iframe",t)}if(i)e.style.display="none",window.setTimeout(function(){$(e).attr("src","about:blank"),window.setTimeout(function(){console.log("IFRAME and SubIFrame Removed"),$(e).remove()},1e3)},1e3);else{try{e.style.display="none",$(e).attr("src","about:blank")}catch(t){console.log("delTabOfIndex",t)}window.setTimeout(function(){$(e).remove()},1e3)}}else $(e).remove();this.tabs.splice(t,1),c(),this.pageDisplayCtrl()};function c(){if(r.curOnTab>r.tabs.length-1&&(r.curOnTab=r.tabs.length-1),r.curOnTab>=0){var t=void 0;void 0!==r.option.onChanging&&null!=r.option.onChanging&&(t=r.option.onChanging(null,null,r.tabs[r.curOnTab])),!1!==t&&(r.curOnTab=r.curOnTab,r.draw())}}this.calcTabPosSize=function(t){var e=0,i=null,o=void 0!==this.option.icons&&null!=this.option.icons?this.option.iconSize:0,n=1==this.option.closable?this.option.iconSize:0,r=2*this.option.tabMargin+(o+n)+6;this.ctx.font=this.option.style.font,this.ctx.fillStyle=this.option.style.fontColor;for(var a=0,s=0;s<t.length;s++)(i=t[s]).visible&&(i.rect.l=e,i.rect.t=0,i.rect.w=this.ctx.measureText(i.text).width+r+1,i.rect.h=this.height,i.rect.r=i.rect.l+i.rect.w,i.rect.b=i.rect.t+i.rect.h,i.rect.tL=i.rect.l+this.option.tabMargin+o+3,i.rect.tT=i.rect.h/2+6,e+=i.rect.w,a++),i.isShow=!0;if(e<this.width){if(1==this.option.fitWidth){var l=this.width-e,h=Math.floor(l/a),c=l%a;for(e=0,s=0;s<t.length;s++)(i=t[s]).visible&&(i.rect.l=e,i.rect.w+=h,i.rect.r=i.rect.l+i.rect.w,i.rect.tL=i.rect.l+this.option.tabMargin+o+3,e+=i.rect.w);for(s=t.length-1;s>=0;s--)if((i=t[s]).visible){i.rect.w+=c+1;break}}}else{for(s=t.length-1;s>=0;s--)if(t[s].visible){if(this.curOnTab==s)break;if((i=t[s]).isShow=!1,30+(e-=i.rect.w)<this.width)break}if(!(e+30<this.width)){for(s=0;s<t.length;s++)if(t[s].visible){if(this.curOnTab==s)break;if((i=t[s]).isShow=!1,30+(e-=i.rect.w)<this.width)break}for(e=0,s=0;s<t.length;s++)(i=t[s]).visible&&i.isShow&&(i.rect.l=e,i.rect.t=0,i.rect.w=this.ctx.measureText(i.text).width+r+1,i.rect.h=this.height,i.rect.r=i.rect.l+i.rect.w,i.rect.b=i.rect.t+i.rect.h,i.rect.tL=i.rect.l+this.option.tabMargin+o+3,i.rect.tT=i.rect.h/2+6,e+=i.rect.w)}}},this.curOnTab=-1;var u=null;this.draw=function(){try{void 0!==r.option.icons&&null!=r.option.icons?r.option.icons.loaded?(window.clearInterval(u),r._draw()):u=window.setInterval(this.draw,50):r._draw()}catch(t){console.log(t.message),window.clearInterval(u)}};var d=!1,f=[];this._draw=function(){this.calcTabPosSize(this.tabs);var t=null,e=this.ctx,i=this.option.icons;e.fillStyle=this.option.style.bgColor,e.fillRect(0,0,this.width,this.height),f=[];for(var o=0,n=0;n<this.tabs.length;n++)if(this.tabs[n].visible)if(this.tabs[n].isShow){if(t=this.tabs[n].rect,e.fillStyle=this.option.style.borderColor,e.fillRect(t.l,t.t,t.w,t.h),this.curOnTab==n?(e.fillStyle=this.option.style.tabOn,e.fillRect(t.l,t.t,t.w-1,t.h)):(e.fillStyle=this.option.style.tabOff,e.fillRect(t.l,t.t,t.w-1,t.h-1)),void 0!==this.option.icons&&null!=this.option.icons&&i.draw(this.tabs[n].img,e,t.l+this.option.tabMargin,t.h/2-this.option.iconSize/2),this.option.closable){var r=this.tabs[n].isCloseOver?"_closeOver":"_close";i.draw(r,e,t.r-this.option.tabMargin-this.option.iconSize,t.h/2-this.option.iconSize/2),f.push({l:t.r-this.option.tabMargin-this.option.iconSize,r:t.r-this.option.tabMargin,tab:this.tabs[n]})}e.font=this.option.style.font,e.fillStyle=this.option.style.fontColor,e.textAlign="left",e.fillText(this.tabs[n].text,t.tL,t.tT)}else o++;o>0&&(i.draw("_more",e,this.width-30,this.height/2-this.option.iconSize/2),e.font="9px arial",e.fillStyle=this.option.style.fontColor,e.textAlign="left",e.fillText(o+"",this.width-14,this.height/2+4.5,this.option.iconSize),f.push({l:this.width-30,r:this.width-30+this.option.iconSize,tab:"_more"})),d=!0},this.tcCanvas.bind("mousemove",function(t){r.mouseEventsDistribute("mousemove",t)}),this.tcCanvas.bind("mousedown",function(t){r.mouseEventsDistribute("mousedown",t)}),this.tcCanvas.bind("mouseup",function(t){r.mouseEventsDistribute("mouseup",t)}),this.tcCanvas.bind("click",function(t){r.mouseEventsDistribute("click",t)}),this.tcCanvas.bind("dblclick",function(t){r.mouseEventsDistribute("dblclick",t)}),this.tcCanvas.bind("mouseout",function(t){r.mouseEventsDistribute("mouseout",t)}),this.tcCanvas.bind("contextmenu",function(t){r.mouseEventsDistribute("contextmenu",t)}),this.getEventedTab=function(t){for(var e=-1,i=null,o=0;o<this.tabs.length;o++)if(this.tabs[o].visible&&this.tabs[o].isShow){i=this.tabs[o].rect;var n=t.offsetX>=i.l&&t.offsetX<=i.r,r=t.offsetY>=i.t&&t.offsetY<=i.b;if(n&&r){e=o;break}}return e},this.getEventRectTab=function(t){for(var e=null,i=null,o=0;o<f.length;o++)if(i=f[o],t.offsetX>=i.l&&t.offsetX<=i.r){e=i;break}return e},this.mouseEventsDistribute=function(t,e){var i=["mousemove","mousedown","mouseup","click","dblclick","mouseout","contextmenu"];switch(function(t){for(var e in i)if(i[e]==t)return parseInt(e)}(t)){case 0:if(null!=(h=this.getEventRectTab(e))){if("_more"!=h.tab){for(var o=0;o<this.tabs.length;o++)this.tabs[o].isCloseOver=!1;h.tab.isCloseOver=!0,this.draw()}}else{var n=!1;for(o=0;o<this.tabs.length;o++)n|=this.tabs[o].isCloseOver,this.tabs[o].isCloseOver=!1;n&&this.draw()}break;case 1:break;case 2:if(0==e.button)if(null!=(h=this.getEventRectTab(e))){if("_more"!=h.tab){var a=void 0;if(void 0!==this.option.onClosing&&null!=this.option.onClosing)return void this.option.onCloseIcon(e,h.tab);!1!==a&&(this.curOnTab>this.getTabIndex(h.tab.id)&&this.curOnTab--,this.delTabOfID(h.tab.id),this.draw())}}else if((c=this.getEventedTab(e))>=0&&this.curOnTab!=c){if(a=void 0,void 0!==this.option.onChanging&&null!=this.option.onChanging){var s=null;this.curOnTab>=0&&(s=this.tabs[this.curOnTab]),a=this.option.onChanging(e,s,this.tabs[c])}!1!==a&&(this.curOnTab=c,this.pageDisplayCtrl(),this.draw())}break;case 3:var l=!1;return null!=(h=this.getEventRectTab(e))&&"_more"==h.tab&&(a=void 0,void 0!==this.option.onMore&&null!=this.option.onMore&&(a=this.option.onMore(e,r)),l=!0),l||(c=this.getEventedTab(e))>=0&&void 0!==this.option.onClick&&null!=this.option.onClick&&this.option.onClick(e,this.tabs[c]),e.preventDefault(),!1;case 4:break;case 5:for(n=!1,o=0;o<this.tabs.length;o++)n|=this.tabs[o].isCloseOver,this.tabs[o].isCloseOver=!1;n&&this.draw();break;case 6:var h,c;return l=!1,null!=(h=this.getEventRectTab(e))&&"_more"==h.tab&&(a=void 0,void 0!==this.option.onMore&&null!=this.option.onMore&&(a=this.option.onMore(e,r)),l=!0),l||(c=this.getEventedTab(e))>=0&&void 0!==this.option.onContext&&null!=this.option.onContext&&this.option.onContext(e,this.tabs[c]),e.preventDefault(),!1}},this.init()};$wai.util=new function(){this.otherParameters=new Array,this.showModalDialogSupported=!0,this.callbackMethod=null,this.dialogArguments=null,this.cacheLoader=[],this.cacheAdder=null,this.getCachedURL=function(t){for(var e=null,i=0;i<this.cacheLoader.length&&(void 0===this.cacheLoader[i]||null===this.cacheLoader[i]||null===(e=JSON.parse(JSON.stringify(this.cacheLoader[i](t)))));i++);return $wai.debug>30&&console.log("$wai.util.getCachedURL : "+t+"\n",e),e},this.setCachedURL=function(t,e){null!==this.cacheAdder&&this.cacheAdder(t,e)},this.showModalDialog=function(t,e,o,n){var r,a,s="no",l="no",h="no",c=o.split(";");for(i=0;i<c.length;i++){var u=c[i].split(":"),d=u[0],f=u[1];d&&(d=d.trim().toLowerCase()),f&&(f=f.trim().toLowerCase()),"dialogheight"==d?a=f.replace("px",""):"dialogwidth"==d?r=f.replace("px",""):"resizable"==d?s=f:"scroll"==d?l=f:"status"==d&&(h=f)}var p=window.screenX+window.outerWidth/2-r/2,g=window.screenY+window.outerHeight/2-a/2,v=window.open(t,"ShowModalDialog"+t,"toolbar=no, location=no, directories=no, status="+h+", menubar=no, scrollbars="+l+", resizable="+s+", copyhistory=no, width="+r+", height="+a+", top="+g+", left="+p);this.dialogArguments=e,this.callbackMethod=null!=n?n:null,v.focus()},this.getDialogArgumentsInner=function(){return this.dialogArguments},this.getCallbackMethodName=function(){return this.callbackMethod},this.getDialogArguments=function(){return opener.$wai.util.dialogArguments},this.setReturnValue=function(t){if(null==opener||opener.closed){if(null!=parent.opener&&!parent.opener.closed){e=parent.opener.$wai.util.getCallbackMethodName();try{null!=e?parent.opener.$wai.util.callbackMethod(t):parent.opener.showModalDialogCallback(t)}catch(t){console.error("There was an error processing the popup. \nError contents : "+t)}}}else{var e=opener.$wai.util.getCallbackMethodName();try{null!=e?opener.$wai.util.callbackMethod(t):opener.showModalDialogCallback(t)}catch(t){console.error("There was an error processing the popup. \nError contents : "+t)}}},this.formText=function(t,e,i){for(var o="",n=0;n<e;n++)o+=" ";return o="r"==i?(o+=t).substr(o.length-e,e):(o=t+o).substr(0,e)},this.json2text=function(t,e,i){var o=160;void 0!==i&&(o=i);var n=[];return function t(e,i,n,r,a){var s=0;for(var l in e)if(typeof e[l]!=typeof{}){if("string"==typeof e[l])if(s>0)n.push(i+',"'+l+'":"'+e[l]+'"');else{var h=i;a>1&&(h=n.pop()),n.push(h+'"'+l+'":"'+e[l]+'"')}else s>0?n.push(i+',"'+l+'":'+e[l]):(h=i,a>1&&(h=n.pop()),n.push(h+'"'+l+'":'+e[l]));s++}for(var l in e)if(typeof e[l]==typeof{}&&null!==e[l]){if(void 0!==e[l].datasets)for(var c=0;c<e[l].datasets.length;c++)void 0!==e[l].datasets[c]&&delete e[l].datasets[c]._meta;var u=JSON.stringify(e[l]),d=void 0!==e[l].length;(u+"").trim().replace(/\t/g,"").length<=o?s>0?r?n.push(i+","+u):n.push(i+',"'+l+'":'+u):r?n.push(i+u):n.push(i+'"'+l+'":'+u):(s>0?d?r?n.push(i+",["):n.push(i+',"'+l+'" : ['):r?n.push(i+",{"):n.push(i+',"'+l+'" : {'):d?r?n.push(i+"["):n.push(i+'"'+l+'" : ['):r?n.push(i+"{"):n.push(i+'"'+l+'" : {'),t(e[l],i+"  ",n,d,a+1),d?n.push(i+"]"):n.push(i+"}")),s++}}(t,e,n,!1,0),n.join("\n")},this.getJSONAttribute=function(t){var e=void 0;return void 0!==t&&(e=JSON.parse(JSON.stringify(t))),e},this.setIframeHtmlText=function(t,e){var i=t,o=null;try{o=i.contentDocument||i.contentWindow.document}catch(t){o=void 0}void 0===o&&(o=i.window.document),o.write(e),o.close()},this.selfReplace=function(t){console.log("$wai.util.selfReplace"),window.setTimeout(function(){try{document.clear()}catch(t){}document.write(t),document.close()},10)},this.getPageParams=function(){var t=(location.href+"").split("?"),e={};if(t.length>1)for(var i=t[1].split("&"),o=0;o<i.length;o++){var n=i[o].split("=");2==n.length&&(e[n[0]]=decodeURI(n[1]))}return e},this.numberToCurrency=function(t,e,i,o){e=e||".",i=i||",",o=null==o?2:o;var n=t.toFixed(o),r=new RegExp("^(-?\\d{1,3})((?:\\d{3})+)(\\.(\\d{"+o+"}))?$").exec(n);return r?r[1]+r[2].replace(/\d{3}/g,i+"$&")+(r[4]?e+r[4]:""):n.replace(".",e)};var t=function(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer};if($wai.default.downInfo.hasOwnProperty("dynamicServiceDomain")){var e=$wai.default.downInfo.dynamicServiceDomain.split(",");for(var i in e){var o=e[i].split("=");o[0]==window.location.protocol+"//"+window.location.host&&($wai.default.downInfo.serviceDomain=o[1])}}var n=null;this.FileDownload=function(e){var i="/";if(arguments.length<=0)alert("The Parameter does not exist.");else{for(var o=0;o<arguments.length-1;o++)i+=arguments[o]+"/";if(fileName=arguments[arguments.length-1],i.indexOf("./")>-1)alert("Movement of the parent directory is prohibited. \r\nPlease check your path again.");else{var r=$wai.default.downInfo.webRoots+i;n=new WebSocket($wai.default.downInfo.serviceDomain);var a,s="_"+Math.random().toString(36).substr(2,9);n.binaryType="arraybuffer",n.onopen=function(){var t={cmd:"login",data:s};n.send(JSON.stringify(t)),t={cmd:"fileDownload",target:r,data:"request"},n.send(JSON.stringify(t));var e=document.createElement("div");e.id="dialog",e.title="File Download";var i=document.createElement("div");i.class="progress-label",i.innerHTML=" Starting download...",i.style="font-weight: bold; text-shadow: 1px 1px 0 #fff;",e.appendChild(i);var o=document.createElement("div");o.id="progressbar",o.style="margin-top: 20px;",e.appendChild(o),document.body.appendChild(e),$("#dialog").dialog({autoOpen:!1,closeOnEscape:!1,resizable:!1}),$("#progressbar").progressbar({value:0,change:function(){},complete:function(){}})};var l=0;n.onmessage=function(e){if("object"==typeof e.data)a=null==a?e.data:t(a,e.data),$("#progressbar").progressbar({value:(parseInt(a.byteLength)/parseInt(l)*100).toFixed(0)}),sendMsg={cmd:"fileDownload",target:r,data:"next"},n.send(JSON.stringify(sendMsg));else if("EOF"==e.data){var i=new Blob([a]);if(navigator.appVersion.toString().indexOf(".NET")>0)window.navigator.msSaveBlob(i,fileName);else{var o=document.createElement("a");o.href=window.URL.createObjectURL(i),o.download=fileName,document.body.appendChild(o),o.click()}n.close();var s=document.getElementById("dialog");s.parentNode.parentNode.removeChild(s.parentNode),$(".window-shadow").remove()}else{var h=(e.data+"").split(":");"info"==h[0]?(l=h[1],sendMsg={cmd:"fileDownload",target:r,data:"next"},n.send(JSON.stringify(sendMsg))):"message"==h[0]&&alert(h[1])}},n.onclose=function(t){},n.onerror=function(t){alert("ERROR: Check the server daemon.")}}}},this.DataDownload=function(e){var i="/";if(arguments.length<=0)alert("The Parameter does not exist");else{for(var o=0;o<arguments.length-2;o++)i+=arguments[o]+"/";fileName=arguments[arguments.length-2];var r=arguments[arguments.length-1];if(i.indexOf("./")>-1)alert("Movement of the parent directory is prohibited. \r\nPlease check your path again.");else{var a=$wai.default.downInfo.webRoots+i;n=new WebSocket($wai.default.downInfo.serviceDomain);var s,l="_"+Math.random().toString(36).substr(2,9);n.binaryType="arraybuffer",n.onopen=function(){var t={cmd:"login",data:l};n.send(JSON.stringify(t)),t={cmd:"fileDownload",target:a,data:"request"},n.send(JSON.stringify(t));var e=document.createElement("div");e.id="dialog",e.title="File Download";var i=document.createElement("div");i.class="progress-label",i.innerHTML=" Starting download...",i.style="font-weight: bold; text-shadow: 1px 1px 0 #fff;",e.appendChild(i);var o=document.createElement("div");o.id="progressbar",o.style="margin-top: 20px;",e.appendChild(o),document.body.appendChild(e),$("#dialog").dialog({autoOpen:!1,closeOnEscape:!1,resizable:!1}),$("#progressbar").progressbar({value:0,change:function(){},complete:function(){}})};var h=0;n.onmessage=function(e){if("object"==typeof e.data)s=null==s?e.data:t(s,e.data),$("#progressbar").progressbar({value:(parseInt(s.byteLength)/parseInt(h)*100).toFixed(0)}),sendMsg={cmd:"fileDownload",target:a,data:"next"},n.send(JSON.stringify(sendMsg));else if("EOF"==e.data){for(var i="",o=new Uint8Array(s),l=o.byteLength,c=0;c<l;c++)i+=String.fromCharCode(o[c]);r(fileName,window.btoa(i)),n.close();var u=document.getElementById("dialog");u.parentNode.parentNode.removeChild(u.parentNode),$(".window-shadow").remove()}else{var d=(e.data+"").split(":");"info"==d[0]?(h=d[1],sendMsg={cmd:"fileDownload",target:a,data:"next"},n.send(JSON.stringify(sendMsg))):"message"==d[0]&&alert(d[1])}},n.onclose=function(t){},n.onerror=function(t){alert("ERROR: Check the server daemon.")}}}},this.FileUpload=function(t){var e="";if(arguments.length<=0)alert("The Parameter does not exist.");else{for(var i=0;i<arguments.length-1;i++)e+=arguments[i]+"/";if(e=e.substr(0,e.length-1),file=arguments[arguments.length-1],e.indexOf("./")>-1)alert("Movement of the parent directory is prohibited. \r\nPlease check your path again.");else{var o=$wai.default.downInfo.webRoots+e;n=new WebSocket($wai.default.downInfo.serviceDomain);var r="_"+Math.random().toString(36).substr(2,9);n.binaryType="arraybuffer",n.onopen=function(){var t={cmd:"login",data:r};n.send(JSON.stringify(t)),t={cmd:"fileUpload",target:o,data:"_"},n.send(JSON.stringify(t));var e=new FileReader,i=new ArrayBuffer;e.loadend=function(){},e.onload=function(t){i=t.target.result,n.send(i),n.close()},e.readAsArrayBuffer(file)},n.onmessage=function(t){alert(t.data),n.close()},n.onclose=function(){},n.onerror=function(t){alert("ERROR: Check the server daemon.")}}}},this.FileUploadCallback=function(t){var e="";if(arguments.length<=0)alert("The Parameter does not exist.");else{for(var i=0;i<arguments.length-2;i++)e+=arguments[i]+"/";e=e.substr(0,e.length-1),file=arguments[arguments.length-2];var o=arguments[arguments.length-1];if(e.indexOf("./")>-1)alert("Movement of the parent directory is prohibited. \r\nPlease check your path again.");else{var r=$wai.default.downInfo.webRoots+e;n=new WebSocket($wai.default.downInfo.serviceDomain);var a="_"+Math.random().toString(36).substr(2,9);n.binaryType="arraybuffer",n.onopen=function(){var t={cmd:"login",data:a};n.send(JSON.stringify(t)),t={cmd:"fileUpload",target:r,data:"_"},n.send(JSON.stringify(t));var e=new FileReader,i=new ArrayBuffer;e.loadend=function(){},e.onload=function(t){i=t.target.result,n.send(i)},e.readAsArrayBuffer(file)},n.onmessage=function(t){o(t.data),n.close()},n.onclose=function(){},n.onerror=function(t){alert("ERROR: Check the server daemon.")}}}},this.__ExcelUpload=function(t,e,i){(function(t,e){return s(t).then(function(t){var i=t.sheet(0),o=i._rows,n=new Object;if("_"==e){var r=new Array,a=new Array,s=!0;o.forEach(function(t){var e=!0,i=0,o=new Object;t._cells.forEach(function(t){var n=t.value()||"";n=String(n);var a=new Object,l=new Object;if(s){"^"==n.charAt(0)?(l.alignment="center",n=n.substring(1,n.length)):">"==n.charAt(0)?(l.alignment="right",n=n.substring(1,n.length)):"<"==n.charAt(0)&&(l.alignment="left",n=n.substring(1,n.length)),a.alignment="center",a.editable="true";var h=n.split(";");2==h.length?(l.type="CalcEdit",l.displayformat=h[1],a.text=h[0],a.field=h[0]):(l.type="text",a.text=n,a.field=n),a.editor=l,r.push(a)}else col=r[i],o[col.field]=n,""!=String(n).trim()&&(e=!1);i++}),s||0==e&&a.push(o),s=!1});var l=new Object;return n.data=a,l.columns=r,n.options=l,JSON.stringify(n)}for(var h=0,c=0,r=new Array,u=e.split(","),d=0;d<u.length;d++){var f=u[d]||"",p=new Object,g=new Object;if(""!=f)if(";"!=f.charAt(0)){"^"==f.charAt(0)?(g.alignment="center",f=f.substring(1,f.length)):">"==f.charAt(0)?(g.alignment="right",f=f.substring(1,f.length)):"<"==f.charAt(0)&&(g.alignment="left",f=f.substring(1,f.length)),p.alignment="center",p.editable="true";var v=f.split(";");2==v.length?(g.type="CalcEdit",g.displayformat=v[1],p.text=v[0],p.field=v[0]):(g.type="text",p.text=f,p.field=f),p.editor=g,r.push(p)}else{var b=(f=f.substring(1,f.length)).split(";");h=Number(b[0]),c=Number(b[1])}}for(var a=new Array,m=h;m<o.length-1;m++){for(var w=o[m],y=!0,C=new Object,x=w._cells,O=0;O<x.length&&O<r.length;O++){var S=x[O+c];if(null!=S){var f=S.value()||"";col=r[O],C[col.field]=f,""!=String(f).trim()&&(y=!1)}}0==y&&a.push(C),s=!1}var l=new Object;return n.data=a,l.columns=r,n.options=l,JSON.stringify(n)})})(t,e).then(function(t){i(t)})},this.ExcelUpload=function(t,e){this.__ExcelUpload(t,"_",e)},this.ExcelUploadNoHead=function(t,e,i,o,n){(null==o||o<0)&&(o=0),(null==n||n<0)&&(n=0),e=e+",;"+o+";"+n,this.__ExcelUpload(t,e,i)};var r={bdLeft:{type:"thin",color:"#000000"},bdTop:{type:"thin",color:"#000000"},bdRight:{type:"thin",color:"#000000"},bdBottom:{type:"thin",color:"#000000"},bdRL:{type:"thin",color:"#000000"},bdLR:{type:"thin",color:"#000000"}},a=[];a.push({styleName:"title",bgColor:"#ffffff",font:{size:16,name:"Tahoma",color:"#000000"},fillPattern:"solidForeground"}),a.push({styleName:"header",bgColor:["#f9fbfd","#dbecfb","#d5e5f3"],font:{size:12,name:"Tahoma",color:"#000000"},fillPattern:"solidForeground"}),a.push({styleName:"cell",bgColor:"#ffffff",font:{size:11,name:"Tahoma",color:"#000000"},fillPattern:"solidForeground"});function s(t){return null==t?XlsxPopulate.fromBlankAsync():t?XlsxPopulate.fromDataAsync(t):Promise.reject("You must select a file.")}function l(t){for(var e="A".charCodeAt(0),i="Z".charCodeAt(0)-e+1,o="";t>=0;)o=String.fromCharCode(t%i+e)+o,t=Math.floor(t/i)-1;return o}function h(t){var e="";if(null!=t.font.size&&(e+='"fontSize" :'+t.font.size),null!=t.font.name&&(e+=',"fontFamily" :"'+t.font.name.replace(/\"/g,"").split(",")[0]+'"'),null!=t.font.color&&(e+=',"fontColor" :"'+t.font.color.replace(/#/g,"")+'"'),null!=t.font.style){var i=t.font.style;i.indexof("bold")>-1&&(e+=',"bold" :true'),i.indexof("italic")>-1&&(e+=',"italic" :true'),i.indexof("strikeout")>-1&&(e+=',"strikethrough" :true')}return null!=t.font.underLine&&(e+=',"underline" :"'+t.font.underLine+'"'),null!=t.font.typeOffset&&(e+=',"subscript" :"'+t.font.typeOffset+'"'),JSON.parse("{"+e+"}")}function c(t,e){return function(t){return s().then(function(e){for(var i=JSON.parse(t).style,o=new Array,n=0;n<i.length;n++)o[i[n].styleName]=i[n];for(var r=JSON.parse(t).vector,a=0;a<r.length;a++){var s=l(r[a].stCell[0]),c=r[a].stCell[1]+1,u=l(r[a].edCell[0]),d=r[a].edCell[1]+1;null==r[a].width&&(r[a].width=100),e.sheet(0).cell(s+c).value(r[a].text),e.sheet(0).cell(s+c).style("border",!0),e.sheet(0).column(s).width(r[a].width/5);var f="",p=(f=""!=r[a].style&&null!=o[r[a].style]?o[r[a].style]:o.header).bgColor;(p=String(p).toUpperCase().replace(/\[/g,"").replace(/\]/g,"").replace(/\"/g,"").replace(/#/g,"")).indexOf(",")>-1?3==(p=p.split(",")).length&&e.sheet(0).cell(s+c).style("fill",{type:"gradient",angle:90,stops:[{position:0,color:p[0]},{position:.5,color:p[1]},{position:1,color:p[2]}]}):e.sheet(0).cell(s+c).style("fill",p);var g=h(f);console.log(g),e.sheet(0).cell(s+c).style(g),null!=r[a].alignment&&""!=r[a].alignment&&e.sheet(0).cell(s+c).style("horizontalAlignment",r[a].alignment),s==u&&c==d||e.sheet(0).range(s+c+":"+u+d).merged(!0)}for(var v=JSON.parse(t).relative[0],b=v.cellData,m=v.cellForm,w=0;w<b.length;w++)for(a=0;a<b[w].length;a++){var y=l(a);if(s=l(m[a][0][0]),c=m[a][0][1]+1,u=l(m[a][1][0]),d=m[a][1][1]+1,null!=m[a][5]&&"N"==m[a][5].charAt(0)){var C=m[a][5].substring(1,m[a][5].length);C=C.replace(",","#,##").replace("undefined",""),e.sheet(0).cell(y+(w+c)).value(Number(b[w][a])).style("numberFormat",C)}else e.sheet(0).cell(y+(w+c)).value(b[w][a]);e.sheet(0).cell(y+(w+c)).style("border",!0),f="",p=(f=""!=m[a][2]&&null!=o[m[a][2]]?o[m[a][2]]:o.cell).bgColor,(p=String(p).toUpperCase().replace(/\[/g,"").replace(/\]/g,"").replace(/\"/g,"").replace(/#/g,"")).indexOf(",")>-1?3==(p=p.split(",")).length&&e.sheet(0).cell(y+(w+c)).style("fill",{type:"gradient",angle:90,stops:[{position:0,color:p[0]},{position:.5,color:p[1]},{position:1,color:p[2]}]}):e.sheet(0).cell(y+(w+c)).style("fill",p),g=h(f),null!=m[a][3]&&""!=m[a][3]&&e.sheet(0).cell(y+(w+c)).style("horizontalAlignment",m[a][3]),null!=m[a][4]&&m[a][4],e.sheet(0).cell(y+(w+c)).style(g)}return e.outputAsync({type:void 0})})}(t).then(function(t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{var i=window.URL.createObjectURL(t),o=document.createElement("a");document.body.appendChild(o),o.href=i,o.download=e,o.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o)}}).catch(function(t){throw alert(t.message||t),t})}this.ExcelDownloadRequest=function(t,e){c(t,e)},this.ExportExcel=function(t){ExcelColumn=[],ExcelRow=[],ExcelForm=[];var e=JSON.parse(JSON.stringify(t.recordset.fieldInfo));for(var i in e){var o=parseInt(i);ExcelColumn.push({text:e[i].name,stCell:[o,0],edCell:[o,0],style:"header",alignment:"center".toLowerCase()}),ExcelForm.push([[o,1],[o,1],"cell","LEFT".toLowerCase()])}var n=t.recordset.getRecords();for(var i in n){var s=[];for(elem in n[i])s.push(n[i][elem]);ExcelRow.push(s)}var l=JSON.stringify({fileName:"default.xlsx",sheetTitle:"Sheet1",sheetStyle:r,style:a,vector:ExcelColumn,relative:[{stCell:ExcelForm[0][0],cellForm:ExcelForm,cellData:ExcelRow}]});this.ExcelDownloadRequest(l,"default.xlsx")},this.ExportExcelDSO=function(t,e,i,o){ExcelColumn=[],ExcelRow=[],ExcelForm=[],e=e.split(";");var n=0;null!=o&&""!=o&&(ExcelColumn.push({text:o,stCell:[0,0],edCell:[0,0],style:"title",alignment:"center"}),n=1);for(var s=0;e.length>s;s++){var l=(e[s]+"").trim(),h="left";""!=l&&("^"==l[0]?(h="center",l=l.substr(1,l.length-1)):">"==l[0]?(h="right",l=l.substr(1,l.length-1)):"<"==l[0]&&(h="left",l=l.substr(1,l.length-1)),ExcelColumn.push({text:l,stCell:[s,n],edCell:[s,n],style:"header",alignment:"center"}),ExcelForm.push([[s,n+1],[s,n+1],"cell",h.toLowerCase()]))}var c=t.recordset.getRecords();for(var u in i=i.split(";"),c){var d=[];for(s=0;i.length>s;s++)d.push(c[u][i[s]]);ExcelRow.push(d)}var f=JSON.stringify({fileName:"default.xlsx",sheetTitle:"Sheet1",sheetStyle:r,style:a,vector:ExcelColumn,relative:[{stCell:ExcelForm[0][0],cellForm:ExcelForm,cellData:ExcelRow}]});this.ExcelDownloadRequest(f,"default.xlsx")},this.ExportExcel_DSO=function(t,e){ExcelColumn=[],ExcelRow=[],ExcelForm=[],e=e.split(";");for(var i=0;e.length>i;i++){var o="left";""!=(c=(e[i]+"").trim())&&("^"==c[0]?(o="center",c=c.substr(1,c.length-1)):">"==c[0]?(o="right",c=c.substr(1,c.length-1)):"<"==c[0]&&(o="left",c=c.substr(1,c.length-1)),ExcelColumn.push({text:c,stCell:[i,0],edCell:[i,0],style:"header",alignment:"center"}),ExcelForm.push([[i,1],[i,1],"cell",o.toLowerCase()]))}var n=t.recordset.getRecords();for(var s in n){var l=[],h=0;for(elem in n[s]){if(h>=e.length)break;var c;""!=(c=(e[h]+"").trim())&&(l.push(n[s][elem]),h++)}ExcelRow.push(l)}var u=JSON.stringify({fileName:"default.xlsx",sheetTitle:"Sheet1",sheetStyle:r,style:a,vector:ExcelColumn,relative:[{stCell:ExcelForm[0][0],cellForm:ExcelForm,cellData:ExcelRow}]});this.ExcelDownloadRequest(u,"default.xlsx")},this.getJsonValue=function(t,e,i,o){var n=t,r="";return $.ajax({type:"GET",url:n,dataType:"json",async:!1,success:function(t){for(var n in t)if(t[n][e]==o){r=t[n][i];break}}}),r},this.addComp=function(t,e){comp=$.parseHTML($.trim(e)),document.getElementById(t).appendChild(comp[0]),$wai.core.generateAll()},this.delComp=function(t){var e=document.getElementById("$wai$"+t+"$");$(e).remove(),delete window[t]}};var t=window.MutationObserver||window.WebKitMutationObserver;$.fn.attrchange=function(e,i){if("object"==typeof e){var o={trackValues:!1,callback:$.noop};if("function"==typeof e?o.callback=e:$.extend(o,e),o.trackValues&&this.each(function(t,e){for(var i,o={},n=(t=0,e.attributes),r=n.length;t<r;t++)o[(i=n.item(t)).nodeName]=i.value;$(this).data("attr-old-value",o)}),t){var n={subtree:!1,attributes:!0,attributeOldValue:o.trackValues},r=new t(function(t){t.forEach(function(t){var e=t.target;o.trackValues&&(t.newValue=$(e).attr(t.attributeName)),void 0===$(this).data("attrchange-tdisconnect")&&o.callback.call(e,t)})});return this.data("attrchange-method","Mutation Observer").data("attrchange-obs",r).each(function(){r.observe(this,n)})}return function(){var t=document.createElement("p"),e=!1;if(t.addEventListener)t.addEventListener("DOMAttrModified",function(){e=!0},!1);else{if(!t.attachEvent)return!1;t.attachEvent("onDOMAttrModified",function(){e=!0})}return t.setAttribute("id","target"),e}()?this.data("attrchange-method","DOMAttrModified").on("DOMAttrModified",function(t){t.originalEvent&&(t=t.originalEvent),t.attributeName=t.attrName,t.oldValue=t.prevValue,void 0===$(this).data("attrchange-tdisconnect")&&o.callback.call(this,t)}):"onpropertychange"in document.body?this.data("attrchange-method","propertychange").on("propertychange",function(t){t.attributeName=window.event.propertyName,function(t,e){if(t){var i=this.data("attr-old-value");if(e.attributeName.indexOf("style")>=0){i.style||(i.style={});var o=e.attributeName.split(".");e.attributeName=o[0],e.oldValue=i.style[o[1]],e.newValue=o[1]+":"+this.prop("style")[$.camelCase(o[1])],i.style[o[1]]=e.newValue}else e.oldValue=i[e.attributeName],e.newValue=this.attr(e.attributeName),i[e.attributeName]=e.newValue;this.data("attr-old-value",i)}}.call($(this),o.trackValues,t),void 0===$(this).data("attrchange-tdisconnect")&&o.callback.call(this,t)}):this}if("string"==typeof e&&$.fn.attrchange.hasOwnProperty("extensions")&&$.fn.attrchange.extensions.hasOwnProperty(e))return $.fn.attrchange.extensions[e].call(this,i)}}();